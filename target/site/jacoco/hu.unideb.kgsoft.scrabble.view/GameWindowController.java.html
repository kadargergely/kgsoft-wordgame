<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GameWindowController.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">kgsoft-scrabble</a> &gt; <a href="index.source.html" class="el_package">hu.unideb.kgsoft.scrabble.view</a> &gt; <span class="el_source">GameWindowController.java</span></div><h1>GameWindowController.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">package hu.unideb.kgsoft.scrabble.view;</span>

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.StringJoiner;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import hu.unideb.kgsoft.scrabble.Computer;
import hu.unideb.kgsoft.scrabble.Controller;
import hu.unideb.kgsoft.scrabble.Dictionary;
import hu.unideb.kgsoft.scrabble.GameState;
import hu.unideb.kgsoft.scrabble.GameView;
import hu.unideb.kgsoft.scrabble.Gameboard;
import hu.unideb.kgsoft.scrabble.Main;
import javafx.beans.value.ChangeListener;
import javafx.beans.value.ObservableValue;
import javafx.concurrent.Task;
import javafx.concurrent.Worker;
import javafx.concurrent.Worker.State;
import javafx.event.EventHandler;
import javafx.fxml.FXML;
import javafx.scene.canvas.Canvas;
import javafx.scene.canvas.GraphicsContext;
import javafx.scene.control.Alert;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.Button;
import javafx.scene.control.ButtonBar.ButtonData;
import javafx.scene.control.ButtonType;
import javafx.scene.control.ChoiceDialog;
import javafx.scene.control.Label;
import javafx.scene.control.ProgressIndicator;
import javafx.scene.image.Image;
import javafx.scene.input.MouseEvent;
import javafx.scene.paint.Color;

public class GameWindowController implements GameView {
    
<span class="nc" id="L41">    private static Logger logger = LoggerFactory.getLogger(GameView.class);</span>

    @FXML
    private Canvas gameCanvas;
    @FXML
    private Button doneButton;
    @FXML
    private Button redrawButton;
    @FXML
    private Button passButton;
    @FXML
    private Label playerNameLabel;
    @FXML
    private Label computerNameLabel;
    @FXML
    private Label playerScoreLabel;
    @FXML
    private Label computerScoreLabel;
    @FXML
    private Label lastWordOrWordsLabel;
    @FXML
    private Label lastWordOrWordsListingLabel;
    @FXML
    private Label lastWordOrWordsPointsLabel;
    @FXML
    private Label currWordOrWordsLabel;
    @FXML
    private Label currWordOrWordsListingLabel;
    @FXML
    private Label currWordOrWordsPointsLabel;
    @FXML
    private Label computerThinkingLabel;
    @FXML
    private ProgressIndicator computerThinkingIndicator;
    /**
     * The &lt;code&gt;GraphicsContext&lt;/code&gt; of the canvas.
     */
    private GraphicsContext gc;

    /**
     * A list of the letter sprites that the game uses.
     */
    private List&lt;Image&gt; letterSprites;
    /**
     * The background image of the canvas.
     */
    private Image backgroundImage;
    /**
     * A reference to the &lt;code&gt;Controller&lt;/code&gt; object.
     */
    private Controller mainCtr;

    /**
     * The constructor. The constructor is called before the initialize()
     * method.
     */
<span class="nc" id="L97">    public GameWindowController() {</span>
<span class="nc" id="L98">    }</span>

    /**
     * Initializes the controller class. This method is automatically called
     * after the fxml file has been loaded.
     */
    @FXML
    private void initialize() {
        // Load letter sprites.
<span class="nc" id="L107">        letterSprites = new ArrayList&lt;Image&gt;();</span>
<span class="nc" id="L108">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L109">                &quot;/Images/A.png&quot;).toString()));</span>
<span class="nc" id="L110">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L111">                &quot;/Images/A2.png&quot;).toString()));</span>
<span class="nc" id="L112">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L113">                &quot;/Images/B.png&quot;).toString()));</span>
<span class="nc" id="L114">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L115">                &quot;/Images/C.png&quot;).toString()));</span>
<span class="nc" id="L116">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L117">                &quot;/Images/CS.png&quot;).toString()));</span>
<span class="nc" id="L118">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L119">                &quot;/Images/D.png&quot;).toString()));</span>
<span class="nc" id="L120">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L121">                &quot;/Images/E.png&quot;).toString()));</span>
<span class="nc" id="L122">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L123">                &quot;/Images/E2.png&quot;).toString()));</span>
<span class="nc" id="L124">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L125">                &quot;/Images/F.png&quot;).toString()));</span>
<span class="nc" id="L126">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L127">                &quot;/Images/G.png&quot;).toString()));</span>
<span class="nc" id="L128">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L129">                &quot;/Images/GY.png&quot;).toString()));</span>
<span class="nc" id="L130">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L131">                &quot;/Images/H.png&quot;).toString()));</span>
<span class="nc" id="L132">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L133">                &quot;/Images/I.png&quot;).toString()));</span>
<span class="nc" id="L134">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L135">                &quot;/Images/I2.png&quot;).toString()));</span>
<span class="nc" id="L136">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L137">                &quot;/Images/J.png&quot;).toString()));</span>
<span class="nc" id="L138">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L139">                &quot;/Images/K.png&quot;).toString()));</span>
<span class="nc" id="L140">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L141">                &quot;/Images/L.png&quot;).toString()));</span>
<span class="nc" id="L142">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L143">                &quot;/Images/LY.png&quot;).toString()));</span>
<span class="nc" id="L144">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L145">                &quot;/Images/M.png&quot;).toString()));</span>
<span class="nc" id="L146">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L147">                &quot;/Images/N.png&quot;).toString()));</span>
<span class="nc" id="L148">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L149">                &quot;/Images/NY.png&quot;).toString()));</span>
<span class="nc" id="L150">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L151">                &quot;/Images/O.png&quot;).toString()));</span>
<span class="nc" id="L152">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L153">                &quot;/Images/O2.png&quot;).toString()));</span>
<span class="nc" id="L154">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L155">                &quot;/Images/O3.png&quot;).toString()));</span>
<span class="nc" id="L156">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L157">                &quot;/Images/O4.png&quot;).toString()));</span>
<span class="nc" id="L158">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L159">                &quot;/Images/P.png&quot;).toString()));</span>
<span class="nc" id="L160">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L161">                &quot;/Images/R.png&quot;).toString()));</span>
<span class="nc" id="L162">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L163">                &quot;/Images/S.png&quot;).toString()));</span>
<span class="nc" id="L164">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L165">                &quot;/Images/SZ.png&quot;).toString()));</span>
<span class="nc" id="L166">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L167">                &quot;/Images/T.png&quot;).toString()));</span>
<span class="nc" id="L168">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L169">                &quot;/Images/TY.png&quot;).toString()));</span>
<span class="nc" id="L170">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L171">                &quot;/Images/U.png&quot;).toString()));</span>
<span class="nc" id="L172">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L173">                &quot;/Images/U2.png&quot;).toString()));</span>
<span class="nc" id="L174">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L175">                &quot;/Images/U3.png&quot;).toString()));</span>
<span class="nc" id="L176">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L177">                &quot;/Images/U4.png&quot;).toString()));</span>
<span class="nc" id="L178">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L179">                &quot;/Images/V.png&quot;).toString()));</span>
<span class="nc" id="L180">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L181">                &quot;/Images/Z.png&quot;).toString()));</span>
<span class="nc" id="L182">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L183">                &quot;/Images/ZS.png&quot;).toString()));</span>
<span class="nc" id="L184">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L185">                &quot;/Images/Joker.png&quot;).toString()));</span>
<span class="nc" id="L186">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L187">                &quot;/Images/AJ.png&quot;).toString()));</span>
<span class="nc" id="L188">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L189">                &quot;/Images/A2J.png&quot;).toString()));</span>
<span class="nc" id="L190">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L191">                &quot;/Images/BJ.png&quot;).toString()));</span>
<span class="nc" id="L192">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L193">                &quot;/Images/CJ.png&quot;).toString()));</span>
<span class="nc" id="L194">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L195">                &quot;/Images/CSJ.png&quot;).toString()));</span>
<span class="nc" id="L196">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L197">                &quot;/Images/DJ.png&quot;).toString()));</span>
<span class="nc" id="L198">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L199">                &quot;/Images/EJ.png&quot;).toString()));</span>
<span class="nc" id="L200">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L201">                &quot;/Images/E2J.png&quot;).toString()));</span>
<span class="nc" id="L202">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L203">                &quot;/Images/FJ.png&quot;).toString()));</span>
<span class="nc" id="L204">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L205">                &quot;/Images/GJ.png&quot;).toString()));</span>
<span class="nc" id="L206">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L207">                &quot;/Images/GYJ.png&quot;).toString()));</span>
<span class="nc" id="L208">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L209">                &quot;/Images/HJ.png&quot;).toString()));</span>
<span class="nc" id="L210">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L211">                &quot;/Images/IJ.png&quot;).toString()));</span>
<span class="nc" id="L212">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L213">                &quot;/Images/I2J.png&quot;).toString()));</span>
<span class="nc" id="L214">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L215">                &quot;/Images/JJ.png&quot;).toString()));</span>
<span class="nc" id="L216">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L217">                &quot;/Images/KJ.png&quot;).toString()));</span>
<span class="nc" id="L218">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L219">                &quot;/Images/LJ.png&quot;).toString()));</span>
<span class="nc" id="L220">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L221">                &quot;/Images/LYJ.png&quot;).toString()));</span>
<span class="nc" id="L222">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L223">                &quot;/Images/MJ.png&quot;).toString()));</span>
<span class="nc" id="L224">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L225">                &quot;/Images/NJ.png&quot;).toString()));</span>
<span class="nc" id="L226">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L227">                &quot;/Images/NYJ.png&quot;).toString()));</span>
<span class="nc" id="L228">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L229">                &quot;/Images/OJ.png&quot;).toString()));</span>
<span class="nc" id="L230">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L231">                &quot;/Images/O2J.png&quot;).toString()));</span>
<span class="nc" id="L232">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L233">                &quot;/Images/O3J.png&quot;).toString()));</span>
<span class="nc" id="L234">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L235">                &quot;/Images/O4J.png&quot;).toString()));</span>
<span class="nc" id="L236">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L237">                &quot;/Images/PJ.png&quot;).toString()));</span>
<span class="nc" id="L238">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L239">                &quot;/Images/RJ.png&quot;).toString()));</span>
<span class="nc" id="L240">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L241">                &quot;/Images/SJ.png&quot;).toString()));</span>
<span class="nc" id="L242">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L243">                &quot;/Images/SZJ.png&quot;).toString()));</span>
<span class="nc" id="L244">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L245">                &quot;/Images/TJ.png&quot;).toString()));</span>
<span class="nc" id="L246">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L247">                &quot;/Images/TYJ.png&quot;).toString()));</span>
<span class="nc" id="L248">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L249">                &quot;/Images/UJ.png&quot;).toString()));</span>
<span class="nc" id="L250">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L251">                &quot;/Images/U2J.png&quot;).toString()));</span>
<span class="nc" id="L252">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L253">                &quot;/Images/U3J.png&quot;).toString()));</span>
<span class="nc" id="L254">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L255">                &quot;/Images/U4J.png&quot;).toString()));</span>
<span class="nc" id="L256">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L257">                &quot;/Images/VJ.png&quot;).toString()));</span>
<span class="nc" id="L258">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L259">                &quot;/Images/ZJ.png&quot;).toString()));</span>
<span class="nc" id="L260">        letterSprites.add(new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L261">                &quot;/Images/ZSJ.png&quot;).toString()));</span>

        // Load background image.
<span class="nc" id="L264">        backgroundImage = new Image(GameWindowController.class.getResource(</span>
<span class="nc" id="L265">                &quot;/Images/scrabble_board.png&quot;).toString());</span>

        // get the graphics context and update the canvas
<span class="nc" id="L268">        gc = gameCanvas.getGraphicsContext2D();</span>
<span class="nc" id="L269">        drawBoard();</span>

        // Add event handlers to the canvas.
<span class="nc" id="L272">        gameCanvas.addEventHandler(MouseEvent.MOUSE_MOVED,</span>
<span class="nc" id="L273">                new EventHandler&lt;MouseEvent&gt;() {</span>
                    @Override
                    public void handle(MouseEvent event) {
<span class="nc" id="L276">                        mainCtr.handleMouseMotion(event.getX(), event.getY());</span>
<span class="nc" id="L277">                    }</span>
                });
<span class="nc" id="L279">        gameCanvas.addEventHandler(MouseEvent.MOUSE_DRAGGED,</span>
<span class="nc" id="L280">                new EventHandler&lt;MouseEvent&gt;() {</span>
                    @Override
                    public void handle(MouseEvent event) {
<span class="nc" id="L283">                        mainCtr.handleMouseMotion(event.getX(), event.getY());</span>
<span class="nc" id="L284">                    }</span>
                });
<span class="nc" id="L286">        gameCanvas.addEventHandler(MouseEvent.MOUSE_PRESSED,</span>
<span class="nc" id="L287">                new EventHandler&lt;MouseEvent&gt;() {</span>
                    @Override
                    public void handle(MouseEvent event) {
<span class="nc bnc" id="L290" title="All 4 branches missed.">                        if (event.getX() &gt; 35 &amp;&amp; event.getX() &lt; 515</span>
<span class="nc bnc" id="L291" title="All 4 branches missed.">                                &amp;&amp; event.getY() &gt; 10 &amp;&amp; event.getY() &lt; 490) {</span>
<span class="nc" id="L292">                            int row = ((int) event.getY() - 10) / 32;</span>
<span class="nc" id="L293">                            int col = ((int) event.getX() - 35) / 32;</span>
<span class="nc" id="L294">                            mainCtr.handleMousePressedOnBoard(row, col,</span>
<span class="nc" id="L295">                                    event.getX(), event.getY());</span>
<span class="nc bnc" id="L296" title="All 4 branches missed.">                        } else if (event.getX() &gt; 163 &amp;&amp; event.getX() &lt; 387</span>
<span class="nc bnc" id="L297" title="All 4 branches missed.">                                &amp;&amp; event.getY() &gt; 504 &amp;&amp; event.getY() &lt; 536) {</span>
<span class="nc" id="L298">                            int index = ((int) event.getX() - 163) / 32;</span>
<span class="nc" id="L299">                            mainCtr.handleMousePressedOnTray(index,</span>
<span class="nc" id="L300">                                    event.getX(), event.getY());</span>
                        }
<span class="nc" id="L302">                    }</span>
                });        
        
<span class="nc" id="L305">    }</span>

    public void computerThread(final Computer computer, final Gameboard gboard,
            final Dictionary dict) {
<span class="nc" id="L309">        Task&lt;Void&gt; task = new Task&lt;Void&gt;() {</span>
            @Override
            protected Void call() throws Exception {
<span class="nc" id="L312">                System.out.println(&quot;Computer thread.&quot;);</span>
<span class="nc" id="L313">                computer.play(gboard, dict);</span>
<span class="nc" id="L314">                return null;</span>
            }
        };
<span class="nc" id="L317">        task.stateProperty().addListener(new ChangeListener&lt;Worker.State&gt;() {</span>

            @Override
            public void changed(ObservableValue&lt;? extends State&gt; observable,
                    State oldValue, State newValue) {
<span class="nc bnc" id="L322" title="All 2 branches missed.">                if (newValue == Worker.State.SUCCEEDED) {</span>
<span class="nc" id="L323">                    logger.info(&quot;Computer finished thinking.&quot;);</span>
<span class="nc" id="L324">                    mainCtr.computerReady();</span>
                }
<span class="nc" id="L326">            }</span>
        });

<span class="nc" id="L329">        logger.info(&quot;Computer started thinking...&quot;);</span>
<span class="nc" id="L330">        new Thread(task).start();</span>
<span class="nc" id="L331">    }</span>
    
    public void saveGameThread() {
<span class="nc" id="L334">        Task&lt;Void&gt; task = new Task&lt;Void&gt;() {</span>
            @Override
            protected Void call() throws Exception {
<span class="nc" id="L337">                System.out.println(&quot;Saving game...&quot;);</span>
<span class="nc" id="L338">                mainCtr.saveGame();</span>
<span class="nc" id="L339">                return null;</span>
            }
        };        
<span class="nc" id="L342">        task.stateProperty().addListener(new ChangeListener&lt;Worker.State&gt;() {</span>

            @Override
            public void changed(ObservableValue&lt;? extends State&gt; observable,
                    State oldValue, State newValue) {
<span class="nc bnc" id="L347" title="All 2 branches missed.">                if (newValue == Worker.State.SUCCEEDED) {</span>
<span class="nc" id="L348">                    logger.info(&quot;Game saving process finished.&quot;);</span>
<span class="nc" id="L349">                    mainCtr.gameSaved();</span>
                }
<span class="nc" id="L351">            }</span>
        });

<span class="nc" id="L354">        logger.info(&quot;Game saving process started...&quot;);</span>
<span class="nc" id="L355">        new Thread(task).start();</span>
<span class="nc" id="L356">    }</span>

    @FXML
    private void doneButtonClicked() {
<span class="nc" id="L360">        mainCtr.handleDoneButton();</span>
<span class="nc" id="L361">    }</span>

    @FXML
    private void redrawButtonClicked() {
<span class="nc" id="L365">        mainCtr.handleRedrawButton();</span>
<span class="nc" id="L366">    }</span>

    @FXML
    private void passButtonClicked() {
<span class="nc" id="L370">        mainCtr.handlePassButton();</span>
<span class="nc" id="L371">    }</span>

    /**
     * Sets the reference to the &lt;code&gt;Controller&lt;/code&gt; object.
     * 
     * @param mainCtr
     *            the mainCtr to set
     */
    public void setMainCtr(Controller mainCtr) {
<span class="nc" id="L380">        this.mainCtr = mainCtr;</span>
<span class="nc" id="L381">    }</span>

    @Override
    public void drawTileOnBoard(int tileCode, int row, int col) {
<span class="nc" id="L385">        gc.drawImage(letterSprites.get(tileCode), 35 + col * 32, 10 + row * 32);</span>
<span class="nc" id="L386">    }</span>

    @Override
    public void drawBoard() {
<span class="nc" id="L390">        gc.drawImage(backgroundImage, 0, 0);</span>
<span class="nc" id="L391">        gc.setFill(Color.GREEN);</span>
<span class="nc" id="L392">        gc.fillRect(153, 494, 244, 52);</span>
<span class="nc" id="L393">    }</span>

    @Override
    public double getWidth() {
        // TODO Auto-generated method stub
<span class="nc" id="L398">        return 0;</span>
    }

    @Override
    public double getHeight() {
        // TODO Auto-generated method stub
<span class="nc" id="L404">        return 0;</span>
    }

    @Override
    public void updateGameStateInfo(GameState gameState) {
        // doneButton enable/disable
<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (doneButton.disableProperty().get()) {</span>
<span class="nc bnc" id="L411" title="All 4 branches missed.">            if (gameState.isBoardLegal() &amp;&amp; !gameState.isTileInHand()</span>
<span class="nc bnc" id="L412" title="All 4 branches missed.">                    &amp;&amp; gameState.isWordsCorrect() &amp;&amp; gameState.isPlayersTurn()) {</span>
<span class="nc" id="L413">                doneButton.setDisable(false);</span>
            }
<span class="nc bnc" id="L415" title="All 4 branches missed.">        } else if (!gameState.isBoardLegal() || gameState.isTileInHand()</span>
<span class="nc bnc" id="L416" title="All 4 branches missed.">                || !gameState.isWordsCorrect() || !gameState.isPlayersTurn()) {</span>
<span class="nc" id="L417">            doneButton.setDisable(true);</span>
        }

        // redrawButton enable/disable
<span class="nc bnc" id="L421" title="All 2 branches missed.">        if (redrawButton.disabledProperty().get()) {</span>
<span class="nc bnc" id="L422" title="All 4 branches missed.">            if (!gameState.isMovableTiles() &amp;&amp; gameState.getTilesInBag() &gt; 0</span>
<span class="nc bnc" id="L423" title="All 4 branches missed.">                    &amp;&amp; gameState.isPlayersTurn() &amp;&amp; gameState.isGameStarted()) {</span>
<span class="nc" id="L424">                redrawButton.setDisable(false);</span>
            }
<span class="nc bnc" id="L426" title="All 4 branches missed.">        } else if (gameState.isMovableTiles() || gameState.getTilesInBag() == 0</span>
<span class="nc bnc" id="L427" title="All 4 branches missed.">                || !gameState.isPlayersTurn() || !gameState.isGameStarted()) {</span>
<span class="nc" id="L428">            redrawButton.setDisable(true);</span>
        }

        // passButton enable/disable
<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (passButton.disabledProperty().get()) {</span>
<span class="nc bnc" id="L433" title="All 6 branches missed.">            if (!gameState.isMovableTiles() &amp;&amp; gameState.isPlayersTurn() &amp;&amp; gameState.isGameStarted()) {</span>
<span class="nc" id="L434">                passButton.setDisable(false);</span>
            }
<span class="nc bnc" id="L436" title="All 6 branches missed.">        } else if (gameState.isMovableTiles() || !gameState.isPlayersTurn() || !gameState.isGameStarted()) {</span>
<span class="nc" id="L437">            passButton.setDisable(true);</span>
        }

        // Show Player and Computer names and scores
<span class="nc bnc" id="L441" title="All 4 branches missed.">        if (gameState.isPlayersTurn() &amp;&amp; gameState.isGameStarted()) {</span>
<span class="nc" id="L442">            playerNameLabel.setText(gameState.getPlayerName() + &quot; &lt;--&quot;);</span>
<span class="nc" id="L443">            computerNameLabel.setText(&quot;Számítógép&quot;);</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">        } else if (gameState.isGameStarted()) {</span>
<span class="nc" id="L445">            playerNameLabel.setText(gameState.getPlayerName());</span>
<span class="nc" id="L446">            computerNameLabel.setText(&quot;Számítógép &lt;--&quot;);</span>
<span class="nc" id="L447">        } else {</span>
<span class="nc" id="L448">            playerNameLabel.setText(gameState.getPlayerName());</span>
<span class="nc" id="L449">            computerNameLabel.setText(&quot;Számítógép&quot;);</span>
        }
<span class="nc" id="L451">        playerScoreLabel.setText(Integer.toString(gameState.getPlayerScore()));</span>
<span class="nc" id="L452">        computerScoreLabel.setText(Integer.toString(gameState</span>
<span class="nc" id="L453">                .getComputerScore()));</span>

        // Show last words.
<span class="nc bnc" id="L456" title="All 2 branches missed.">        if (gameState.getLastWords() != null) {</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">            if (gameState.getLastWords().size() &gt; 1) {</span>
<span class="nc" id="L458">                lastWordOrWordsLabel.setText(&quot;Legutóbbi szavak:&quot;);</span>
<span class="nc" id="L459">            } else {</span>
<span class="nc" id="L460">                lastWordOrWordsLabel.setText(&quot;Legutóbbi szó:&quot;);</span>
            }

<span class="nc" id="L463">            StringJoiner sjLastWords = new StringJoiner(&quot;, &quot;);</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">            for (String w : gameState.getLastWords()) {</span>
<span class="nc" id="L465">                sjLastWords.add(w);</span>
            }
<span class="nc" id="L467">            lastWordOrWordsListingLabel.setText(sjLastWords.toString());</span>
<span class="nc" id="L468">            lastWordOrWordsPointsLabel.setText(Integer.toString(gameState</span>
<span class="nc" id="L469">                    .getLastWordsPoints()));</span>
        }

        // Show current words.
<span class="nc bnc" id="L473" title="All 2 branches missed.">        if (gameState.getCurrentWords() != null) {</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">            if (gameState.getCurrentWords().size() &gt; 1) {</span>
<span class="nc" id="L475">                currWordOrWordsLabel.setText(&quot;Éppen kirakott szavak:&quot;);</span>
<span class="nc" id="L476">            } else {</span>
<span class="nc" id="L477">                currWordOrWordsLabel.setText(&quot;Éppen kirakott szó:&quot;);</span>
            }
        }

<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (gameState.isBoardLegal()) {</span>
<span class="nc" id="L482">            StringJoiner sjCurrWords = new StringJoiner(&quot;, &quot;);</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">            for (String w : gameState.getCurrentWords()) {</span>
<span class="nc" id="L484">                sjCurrWords.add(w);</span>
            }
<span class="nc bnc" id="L486" title="All 2 branches missed.">            if (gameState.isWordsCorrect()) {</span>
<span class="nc" id="L487">                currWordOrWordsListingLabel.setTextFill(Color.BLACK);</span>
<span class="nc" id="L488">                currWordOrWordsListingLabel.setText(sjCurrWords.toString());</span>
<span class="nc" id="L489">                currWordOrWordsPointsLabel.setText(Integer.toString(gameState</span>
<span class="nc" id="L490">                        .getCurrentWordsPoints()));</span>
<span class="nc" id="L491">            } else {</span>
<span class="nc" id="L492">                currWordOrWordsListingLabel.setTextFill(Color.RED);</span>
<span class="nc" id="L493">                currWordOrWordsListingLabel.setText(sjCurrWords.toString());</span>
<span class="nc" id="L494">                currWordOrWordsPointsLabel.setText(&quot;&quot;);</span>
            }
<span class="nc" id="L496">        } else {</span>
<span class="nc" id="L497">            currWordOrWordsListingLabel.setText(&quot;&quot;);</span>
<span class="nc" id="L498">            currWordOrWordsPointsLabel.setText(&quot;&quot;);</span>
        }

        // Show computer is thinking message.
<span class="nc bnc" id="L502" title="All 4 branches missed.">        if (gameState.isPlayersTurn() || !gameState.isGameStarted()) {</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">            if (computerThinkingLabel.isVisible()) {</span>
<span class="nc" id="L504">                computerThinkingLabel.setVisible(false);</span>
            }
<span class="nc bnc" id="L506" title="All 2 branches missed.">            if (computerThinkingIndicator.isVisible()) {</span>
<span class="nc" id="L507">                computerThinkingIndicator.setVisible(false);</span>
            }
<span class="nc" id="L509">        } else {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">            if (!computerThinkingLabel.isVisible()) {</span>
<span class="nc" id="L511">                computerThinkingLabel.setVisible(true);</span>
            }
<span class="nc bnc" id="L513" title="All 2 branches missed.">            if (!computerThinkingIndicator.isVisible()) {</span>
<span class="nc" id="L514">                computerThinkingIndicator.setVisible(true);</span>
            }
        }

<span class="nc" id="L518">    }</span>

    public String getLetterFromUser() {
<span class="nc" id="L521">        List&lt;String&gt; choices = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L522">        choices.add(&quot;A&quot;);</span>
<span class="nc" id="L523">        choices.add(&quot;Á&quot;);</span>
<span class="nc" id="L524">        choices.add(&quot;B&quot;);</span>
<span class="nc" id="L525">        choices.add(&quot;C&quot;);</span>
<span class="nc" id="L526">        choices.add(&quot;CS&quot;);</span>
<span class="nc" id="L527">        choices.add(&quot;D&quot;);</span>
<span class="nc" id="L528">        choices.add(&quot;E&quot;);</span>
<span class="nc" id="L529">        choices.add(&quot;É&quot;);</span>
<span class="nc" id="L530">        choices.add(&quot;F&quot;);</span>
<span class="nc" id="L531">        choices.add(&quot;G&quot;);</span>
<span class="nc" id="L532">        choices.add(&quot;GY&quot;);</span>
<span class="nc" id="L533">        choices.add(&quot;H&quot;);</span>
<span class="nc" id="L534">        choices.add(&quot;I&quot;);</span>
<span class="nc" id="L535">        choices.add(&quot;Í&quot;);</span>
<span class="nc" id="L536">        choices.add(&quot;J&quot;);</span>
<span class="nc" id="L537">        choices.add(&quot;K&quot;);</span>
<span class="nc" id="L538">        choices.add(&quot;L&quot;);</span>
<span class="nc" id="L539">        choices.add(&quot;LY&quot;);</span>
<span class="nc" id="L540">        choices.add(&quot;M&quot;);</span>
<span class="nc" id="L541">        choices.add(&quot;N&quot;);</span>
<span class="nc" id="L542">        choices.add(&quot;NY&quot;);</span>
<span class="nc" id="L543">        choices.add(&quot;O&quot;);</span>
<span class="nc" id="L544">        choices.add(&quot;Ó&quot;);</span>
<span class="nc" id="L545">        choices.add(&quot;Ö&quot;);</span>
<span class="nc" id="L546">        choices.add(&quot;Ő&quot;);</span>
<span class="nc" id="L547">        choices.add(&quot;P&quot;);</span>
<span class="nc" id="L548">        choices.add(&quot;R&quot;);</span>
<span class="nc" id="L549">        choices.add(&quot;S&quot;);</span>
<span class="nc" id="L550">        choices.add(&quot;SZ&quot;);</span>
<span class="nc" id="L551">        choices.add(&quot;T&quot;);</span>
<span class="nc" id="L552">        choices.add(&quot;TY&quot;);</span>
<span class="nc" id="L553">        choices.add(&quot;U&quot;);</span>
<span class="nc" id="L554">        choices.add(&quot;Ú&quot;);</span>
<span class="nc" id="L555">        choices.add(&quot;Ü&quot;);</span>
<span class="nc" id="L556">        choices.add(&quot;Ű&quot;);</span>
<span class="nc" id="L557">        choices.add(&quot;V&quot;);</span>
<span class="nc" id="L558">        choices.add(&quot;Z&quot;);</span>
<span class="nc" id="L559">        choices.add(&quot;ZS&quot;);</span>

<span class="nc" id="L561">        ChoiceDialog&lt;String&gt; dialog = new ChoiceDialog&lt;String&gt;(&quot;A&quot;, choices);</span>
<span class="nc" id="L562">        dialog.setTitle(&quot;Betű kiválasztása&quot;);</span>
<span class="nc" id="L563">        dialog.setHeaderText(null);</span>
<span class="nc" id="L564">        dialog.setContentText(&quot;Válaszd ki, milyen betűt szeretnél helyettesíteni a dzsókerrel:&quot;);</span>

<span class="nc" id="L566">        Optional&lt;String&gt; result = dialog.showAndWait();</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">        if (result.isPresent()) {</span>
<span class="nc" id="L568">            return result.get().toLowerCase();</span>
        } else {
<span class="nc" id="L570">            return null;</span>
        }
    }
    
    public boolean showAlertToUser(String header, String text, String okText) {
<span class="nc" id="L575">        Alert alert = new Alert(AlertType.CONFIRMATION);</span>
<span class="nc" id="L576">        alert.setTitle(&quot;Megerősítés&quot;);</span>
<span class="nc" id="L577">        alert.setHeaderText(header);</span>
<span class="nc" id="L578">        alert.setContentText(text);</span>

<span class="nc" id="L580">        alert.setHeight(300);</span>
        
<span class="nc" id="L582">        ButtonType buttonTypeOK = new ButtonType(okText);        </span>
<span class="nc" id="L583">        ButtonType buttonTypeCancel = new ButtonType(&quot;Mégsem&quot;, ButtonData.CANCEL_CLOSE);</span>

<span class="nc" id="L585">        alert.getButtonTypes().setAll(buttonTypeOK, buttonTypeCancel);</span>

<span class="nc" id="L587">        Optional&lt;ButtonType&gt; result = alert.showAndWait();</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">        if (result.get() == buttonTypeOK) {</span>
<span class="nc" id="L589">            return true;        </span>
        } else {
<span class="nc" id="L591">            return false;</span>
        }
    }
    
    public void showErrorMessage(String header, String mesg) {
<span class="nc" id="L596">        Alert alert = new Alert(AlertType.ERROR);</span>
<span class="nc" id="L597">        alert.setTitle(&quot;Hiba&quot;);</span>
<span class="nc" id="L598">        alert.setHeaderText(header);</span>
<span class="nc" id="L599">        alert.setContentText(mesg);</span>

<span class="nc" id="L601">        alert.showAndWait();</span>
<span class="nc" id="L602">    }</span>
    
    public void showMessage(String title, String text) {
<span class="nc" id="L605">        Alert alert = new Alert(AlertType.INFORMATION);</span>
<span class="nc" id="L606">        alert.setTitle(title);</span>
<span class="nc" id="L607">        alert.setHeaderText(null);</span>
<span class="nc" id="L608">        alert.setContentText(text);</span>

<span class="nc" id="L610">        alert.showAndWait();</span>
<span class="nc" id="L611">    }</span>

    @Override
    public void drawTileOnTray(int tileCode, int index) {
<span class="nc" id="L615">        gc.drawImage(letterSprites.get(tileCode), 163 + index * 32, 504);</span>

<span class="nc" id="L617">    }</span>

    @Override
    public void drawTileInHand(int tileCode, double mouseX, double mouseY) {
<span class="nc" id="L621">        gc.drawImage(letterSprites.get(tileCode), mouseX, mouseY);</span>
<span class="nc" id="L622">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>